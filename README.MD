# Telegram Commenting Bot Service

Это проект для управления аккаунтами Telegram-ботов, их подключения к каналам и автоматического комментирования постов.
Система использует FastAPI для управления и обработки запросов, SQLAlchemy для работы с базой данных,
а также Pyrogram для взаимодействия с Telegram API.

## Описание

Сервис позволяет создавать аккаунты, назначать прокси, создавать каналы, а также автоматически генерировать комментарии
с помощью OpenAI и публиковать их в каналах Telegram. Боты могут комментировать последние посты каналов.

## Структура проекта

- **api/** — основной код для API и обработки запросов(Там же routers для разделения логики).
- **main.py** — Точка входа, основной обработчик HTTP
- **database/** — модель и работа с базой данных.
- **service/** — обработчики логики для работы с Pyrogram, OpenAI и другими сервисами.
- **templates/** — HTML-шаблоны для веб-интерфейса.
- **static/** — статические файлы для веб-интерфейса.
- **models.py** — SQLAlchemy модели для работы с аккаунтами, каналами, прокси и задачами.
- **session.py** — обработка сессий базы данных.
- **pyrogram_service.py** — логика для работы с Pyrogram.
- **openai_utils.py** — функции для работы с OpenAI (генерация комментариев и имен).
- **redis_service.py** — брокер сообщений Redis.
- **yandex_disk_service.py** — логика работы с яндекс диском для TDATA.
- **config.py** — файл конфигурации загрузки из ".env".
- **.env** — файл для хранения чувствительных данных, токенов (библиотека python-dotenv).

## Логика работы приложения

### 1. **Главная страница и интерфейс**

При запуске приложения, пользователи могут перейти на главную страницу, которая предоставляет интерфейс
для создания и управления аккаунтами, каналами и прокси.
Веб-интерфейс использует FastAPI для рендеринга HTML-страниц с использованием шаблонов Jinja2.

### 2. **Создание аккаунтов**

При создании аккаунта через API или веб-интерфейс, генерируется уникальное имя и фамилия с использованием OpenAI.
Это имя будет использоваться для аккаунта, и оно будет отображаться при комментариях.

### 3. **Запуск комментирования**

Для запуска процесса комментирования используется эндпоинт `/start_commenting/`. В процессе запуска:

- Система генерирует новое имя и фамилию для каждого активного аккаунта.
- Эти данные сохраняются в базе данных.
- Аккаунты начинают комментировать посты в Telegram-каналах, используя полученные данные.

### 4. **Присваивание прокси**

Аккаунтам можно назначать прокси через эндпоинт `/assign_proxy/`.
Это необходимо для обхода блокировок и использования разных IP-адресов для комментирования.

### 5. **Работа с каналами**

Приложение позволяет создавать и управлять каналами через эндпоинты `/channels/`.
Для каждого канала можно указать описание и использовать их в процессе комментирования.

### 6. **Интеграция с OpenAI**

- При создании аккаунта генерируется имя и фамилия с помощью OpenAI.
- Для каждого активного аккаунта при запуске процесса комментирования генерируется новое имя и фамилия.
- Генерация комментариев для постов также осуществляется с помощью OpenAI,
  что позволяет создавать правдоподобные и осмысленные комментарии.

### 7. **Хранения данных для управления аккаунтами**

- Используется логика Яндекс диска для хранения файлов TDATA.
- Файлы загружаются из яндекс диска и папки TDATA. Программа подгружает из яндекс диска и coздает сессии.

## API эндпоинты

- **POST `/accounts/`**: Создание нового аккаунта.
- **GET `/accounts/`**: Получение списка всех аккаунтов.
- **POST `/channels/`**: Создание нового канала.
- **GET `/channels/`**: Получение списка всех каналов.
- **PUT `/assign_proxy/{account_id}`**: Присваивание прокси аккаунту.
- **GET `/start_commenting/`**: Запуск процесса комментирования для активных аккаунтов.
- **GET `/proxies/`**: Получение списка всех прокси.
- **POST `/proxies/`**: Создание нового прокси.
- **POST `/upload_tdata/`**: Загрузка TDATA.
- **POST `/download_tdata/`**: Скачивание TDATA.
- **POST `/check_tdata/{account_id}`**: Проверка TDATA.


## Требования

- Python 3.8+
- FastAPI
- SQLAlchemy
- OpenAI (для генерации имен и комментариев)
- Pyrogram
- uvicorn (для запуска сервера)

## Установка

1. Установите все зависимости и виртуальное окружение:
   ```bash
   python -m venv venv
   source venv/bin/activate (macOS)
   pip install -r requirements.txt

2. Создайте базу данных PostgreSQL:
   ```bash
   createdb nameDB

3. Создайте таблицы в базе данных:
   ```bash
   python database/init_db.py

4. Создайте файл .env со следующими переменными:
   DB_URL=postgresql+asyncpg://userlogin:password@localhost/nameDB
   OPENAI_API_KEY=указать свой
   YANDEX_DISK_TOKEN=указать свой
   YANDEX_DISK_URL=указать свой

5. Запустите приложение:
   ```bash
   uvicorn main:app --reload